$(function(){$(".inline-reservation-calender").pDatepicker({inline:!0,altField:"#inlineCalender",initialValue:!0,calendarType:"gregorian",initialValueType:!0,autoClose:!0,altFormat:"DD MMMM YY",calendar:{gregorian:{locale:"en"}},toolbox:{calendarSwitch:{enabled:!1}},navigator:{scroll:{enabled:!1},text:{btnNextText:"<",btnPrevText:">"}},minDate:(new persianDate).subtract("day",0).valueOf(),checkDate:function(e){return function(e){var a=new persianDate(e).day(),n=(new persianDate(e).startOf("day").unix(),new persianDate(e).endOf("day").unix(),!1);for(var t in availableDays)Number(availableDays[t])===a&&(n=!0);return n}(e)},timePicker:{enabled:!1},onSelect:function(e){var a,n,t,i,r,s,l=new persianDate(e).startOf("day").unix();$("#selectedDay").val(l),a=l,n=$("#PickTimeContainer"),t=$("#PickTimeBody"),i=$("#availableTimes"),r=n.find(".loading-img"),s=n.attr("data-user-id"),$("html, body").animate({scrollTop:n.offset().top-window.innerHeight/2},600),t.addClass("d-none"),r.removeClass("d-none"),t.find(".selected_date span").text($("#inlineCalender").val()),$.post("/users/"+s+"/availableTimes",{timestamp:a},function(e){var a="";e&&void 0!==e.times&&(Object.keys(e.times).forEach(function(n){var t=e.times[n];a+='<div class="position-relative available-times '+(t.can_reserve?"":"disabled")+'">\n<input type="checkbox" name="time[]" id="availableTime'+t.id+'" value="'+t.id+'" '+(t.can_reserve?"":"disabled")+'>\n<label for="availableTime'+t.id+'">'+t.time+"</label>\n",t.can_reserve||(a+='<span class="font-12 badge badge-danger text-white reserved-item">'+reservedLang+"</span>"),a+="</div>"}),i.html(a))}).always(function(){t.removeClass("d-none"),r.addClass("d-none")})}}),$("body").on("click","#followToggle",function(e){e.preventDefault();var a=$(this);a.addClass("loadingbar primary").prop("disabled",!0);var n="/users/"+a.attr("data-user-id")+"/follow";$.get(n,function(e){a.removeClass("loadingbar primary").prop("disabled",!1),e&&200===e.code&&(e.follow?(a.removeClass("btn-primary").addClass("btn-danger"),a.text(unFollowLang)):(a.removeClass("btn-danger").addClass("btn-primary"),a.text(followLang)))})}),$("body").on("click",".js-refresh-captcha",function(e){e.preventDefault(),refreshCaptcha()}),$("body").on("click",".js-send-message",function(e){e.preventDefault(),Swal.fire({html:$("#sendMessageModal").html(),showCancelButton:!1,showConfirmButton:!1,customClass:{content:"p-0 text-left"},onOpen:function(){refreshCaptcha()},width:"42rem"})}),$("body").on("click",".js-send-message-submit",function(e){e.preventDefault();var a=$(this);a.addClass("loadingbar primary").prop("disabled",!0);var n=a.closest("form"),t=n.attr("action"),i=n.serializeObject();$.post(t,i,function(e){e&&200===e.code?(Swal.fire({icon:"success",html:'<h3 class="font-20 text-center text-dark-blue">'+messageSuccessSentLang+"</h3>",showConfirmButton:!1}),setTimeout(function(){window.location.reload()},2e3)):Swal.fire({icon:"error",html:'<h3 class="font-20 text-center text-dark-blue">'+e.message+"</h3>",showConfirmButton:!1})}).fail(function(e){a.removeClass("loadingbar primary").prop("disabled",!1);var t=e.responseJSON;refreshCaptcha(),t&&t.errors&&Object.keys(t.errors).forEach(function(e){var a=t.errors[e],i=n.find('[name="'+e+'"]');i.addClass("is-invalid"),i.parent().find(".invalid-feedback").text(a[0])})})})});
